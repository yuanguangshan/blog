---
title: 有了IP为何还要Mac地址
date: 2023-08-22T12:40:25+08:00
categories: [收藏]
tags: [精品]
---

我在华为上班的时候。有老专家问过我这个问题。不过我当年才入职一个月，是一个萌新。对这个问题也非常的困惑，想了半天也觉得有IP了就不用MAC地址了呗。

随着学习业务的逐渐深入。慢慢的就理解了计算机网络的内在联系。OSI把计算机网络划分为七层。通讯设备制造商主攻方向就是七层网络的第二层与第三层。实际上，只需要第二层网络就能完成通信，根本不需要第三层。那为啥又要有第三层呢？

二层网络的标识就是MAC地址。在进行业务配置的时候，分为专线和专网。专线就是点对点通信，也就是只有两个网口之间的通信，为什么这里强调的是两口网口而不是两台设备，因为一台设备上可以有很多的个网口，其实叫网口不严谨，内部都把这个叫端口，端口又可以分为电口、光口、射频口等。而专网就是一对多的通信，从一个端口进入的数据报文（假设该份报文是发给A设备的），会从多个端口转发出去，此时，该份数据报文被复制了多份，但是有可能只需要一份，其余的报文只不过是增加了网络负担，但是网络通信的特点就是有发就有收，当前从多个端口发送出去了多份一样“内容”的报文，一段时间后，会有一个接收者回复，“我在这呢”。当然，这个“我在这呢”会从专网里面的某个端口进入。至此，二层网络完成了学习，知道了A地址应该从哪个端口发出，下一次再遇到发送给A的数据报文就不再会往所有的端口都复制发送了，MAC地址的作用就在于可以标识出该从哪个端口转发。通讯设备的作用就是数据转发。基于专线专网便可实现数据的转发，并且效率非常高。那么他有什么缺陷吗？有！非常严重的缺陷就在于遇到一个未知MAC地址的报文的时候，会往同一个专网里面的每个端口都复制发送一份。现实中的整个计算机网络，为了保证通信的可靠性，做了很多的冗余，同一个目的地会有很多条路径可达，但是这个冗余也造成了一个问题，那就是“成环”，也就是整个通信链路成了一个环，从A设备发出的数据过一会儿又会自己收到，然后A没有学到MAC地址，又往整个专网里面复制了一份，最终就导致“网络风暴”，整个网络都被这些垃圾报文占有，导致正常的通信瘫痪。不过现在已经发明了很多的环网保护协议来“破环”，所以“网络风暴”已经不常见了。不过，如果我们的通信是基于二层网络来构建，那么简直就是灾难，你想一下，你随便向网络上发送一个未知MAC地址的报文，就“掀起风暴”！那还得了！！！另一个缺陷是，二层网络是静态的，哪些端口能互相转发数据是由配置设置好的。假设当前有ABCDEF六个端口，配置了两个专网ABC和DEF，那么在网络上两个网络是完全隔离的，互相看不见对方的报文，过一段时间，网络状态有变化，需要改成ABD和CEF两个网络的时候只能重新修改通讯设备的配置。通俗点说，你家里的电脑从客厅搬到书房以后，就需要电信公司的人来给重新配置交换机。当然，现实情况不是这样的，因为我们有ip地址。

IP地址在设计的时候就考虑到了“网络风暴”和“配置变化”两个问题。IP地址用的是ttl来解决“网络风暴”问题，也就是一个数据报文最多能转发255次，如果255次还未到达目的地就直接丢弃，并且也不会像二层网络那样简单粗暴的随意复制。不同于二层网络，为了实现动态特性，ip地址是允许用户配置的，而MAC地址是由出厂设置，全球唯一的。所以ip地址是一个变化的东西，它可以是标准允许的任何一个ip地址，所以当一个全新的设备在加入一个网络的时候，可以由网络中的某个服务（DHCP）来给你分配一个“此网络”唯一的ip来实现通信，也就是不需要任何人为的配置便可实现通信。为什么只能分配一个“此网络”唯一的IP，而不是全球唯一的ip呢？在ipv4的时代是做不到的。

那么三层网络那么好，为啥还要有二层网络呢？三层网络相比二层网络就太慢了，二层网络就干一个事，拿到一个数据报文，看一眼MAC地址，是自己认识的，那么就从对应端口转发出去，不认识的，那么就从专网的每个端口都复制一份转发出去。而三层网络的ip地址匹配叫做最长匹配，需要把数据报文打开，然后再去路由表里面匹配，并且是最长匹配，这个查找的过程相对复杂，有些情况还需要cpu介入。注意，在普通的计算机中，cpu的速度是所有组成模块里面最快的。但是在通信设备里面，只要有cpu参与的事，那就奇慢无比。毕竟cpu的处理能力是Ghz这个级别的，但是通信芯片转发报文的速度是100Gb/s级别，甚至1000Gb/s级别的。

在真实的网络中，还有一个协议是介于二层与三层之间的。比三层通信更快，稍微比二层慢，叫MPLS，人为的又给报文打上一个标签，加快报文转发，有兴趣的可以了解一下。

回到问题。在ipv4时代，由于ip不唯一，你所说的情况就不成立。那么到ipv6的时代，得到了全球唯一的ip就不需要MAC了吗?肯定不是。三层网络就是基于二层网络，ip本身是一个动态概念，在设备第一次入网的时候，是没有ip的，此时需要借助二层网络(MAC地址)来获取IP。那由厂家事先就分配好ip行不行，也不行，首先丢失了动态的概念。其次，ip地址是需要分段的，这是为了路由的最长匹配。如果，ip地址都是由厂家事先分配好的，那么你的国产手机带出国去通信会出问题的，大概率直接无网络，小概率能连上网，但是速度奇慢。另一个原因就是，三层网络比二层慢。